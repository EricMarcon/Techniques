---
title: "Moyenne généralisée"
lang: fr-FR
# Code options 
# https://quarto.org/docs/computations/execution-options.html#output-options
execute:
  # show code chunk output
  include: true
  # Show the code in the output
  echo: true
  # Show warnings
  warning: false
  # Cache code results
  cache: false
  # option messages is in the Option chunk for R
bibliography: references.bib
format: 
  html:
    toc: true
    filters: ["fr-nbsp.lua"]
  pdf: default
editor: visual
---

```{r}
#| label: DoNotModify
#| include: false
### Utilities for R. 
# Do not modify unless you don't use R: then, delete this chunk.
# Installation of R packages if necessary
install_packages <- function(packages) {
  invisible(
    sapply(
      packages, 
      FUN = function(package) {
        if (!package %in% installed.packages()[, 1]) {
          install.packages(package, repos = "https://cran.rstudio.com/")
        }
      }
    )
  )
}

# Basic packages
install_packages(c("knitR", "formatR", "kableExtra"))

# Chunk font size hook: allows size='small' or any valid Latex font size in chunk options
def.chunk.hook <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(
  chunk = function(x, options) {
    x <- def.chunk.hook(x, options)
    ifelse(
      options$size == "normalsize", 
      yes = x,
      no = paste0("\n \\", options$size, "\n\n", x, "\n\n \\normalsize")
    )
  }
)
```

```{r}
#| label: Options
#| include: false
### Customized R options for this document
# Delete this chunk if you don't use R

# Add necessary packages here
packages <- c("tidyverse")
# Install them
install_packages(packages)

# knitr options (https://yihui.org/knitr/options/)
knitr::opts_chunk$set(
  # Messages from packages
  message = FALSE,
  # Code chunk automatic format if tidy is TRUE
  tidy = FALSE, 
  # Tidy code options: remove blank lines and cut lines after 50 characters
  tidy.opts = list(blank = FALSE, width.cutoff = 50),
  # Font size in PDF output
  size = "scriptsize", 
  # Select PDF figures in PDF output if PDF file exists beside PNG file
  knitr.graphics.auto_pdf = TRUE
)
# Text width of R functions output
options(width = 50)

# ggplot style
library("tidyverse")
theme_set(theme_bw())
theme_update(
  panel.background = element_rect(fill = "transparent", colour = NA),
  plot.background = element_rect(fill = "transparent", colour = NA)
)
knitr::opts_chunk$set(dev.args = list(bg = "transparent"))

# Random seed
set.seed(973)
```

## Définition

La moyenne généralisée [@Hardy1952] est définie comme $(\sum{w_i x_i^r})^{1 / r}$.

## Calcul

```{r}
meanr <- function(x, w = rep(1 / length(x), length(x)), r = 1) {
  if (r == 0) {
    # Moyenne géométrique
    mean_value <- prod(x^w)
  } else {
    # Moyenne arithmétique pour r = 1
    mean_value <- (sum(w * x^r))^(1 / r)
  }
  return(mean_value)
}

```

## Propriétés

La moyenne d'ordre $-r$ est l'inverse de la moyenne d'ordre $r$ des inverses.

```{r}
X <- replicate(10, runif(1000)) 
# Ordre quelconque
r <- runif(1, min = 0, max = 5)
# Poids quelconques
w <- runif(length(X))
w <- w / sum(w)
# Comparaison des moyennes
meanr(X, w, r)
1 / meanr(1 / X, w, -r)
```

La moyenne de la moyenne d'ordres différents n'est pas la moyenne d'ordre égal au produit des ordres.
L'ordre de calcul des moyennes importe.

```{r}
r1 <- .5
r2 <- 2 
mean(X) 
(meanr(apply(X, 2, meanr, r = r1), r = r2)) 
(meanr(apply(X, 2, meanr, r = r2), r = r1))
```
